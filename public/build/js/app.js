const orden={usuarioId:"",fecha:"",hora:"",nombre:"",productos:[]};var suma=0;const server=window.location.origin;function iniciar(){seleccionarProducto(),validarFecha(),usuarioId(),usuarioNombre()}function usuarioId(){const e=document.getElementById("usuario-id").value;orden.usuarioId=e}function usuarioNombre(){const e=document.getElementById("nombre").value;orden.nombre=e}function validarFecha(){const e=document.getElementById("fecha"),t=document.getElementById("hora");e.addEventListener("input",(function(e){0===new Date(e.target.value).getUTCDay()?(e.target.value="",crearAlerta("Domingos no abierto","error",".fechah1")):orden.fecha=e.target.value})),t.addEventListener("input",(function(e){const t=e.target.value.split(":")[0];t>19||t<7?(e.target.value="",crearAlerta("Hora invalida","error",".fechah1")):orden.hora=e.target.value}))}function seleccionarProducto(){const e=document.getElementById("boton-orden");e.addEventListener("click",(function(t){orden.productos=[],suma=0;const n=document.querySelector(".activo");n&&n.remove();document.querySelectorAll("#cantidad").forEach(t=>{const n=t.parentNode.parentNode;n.childNodes[7].firstChild.nextSibling.value>0?(e.textContent="Actualizar Orden",n.classList.remove("Noselected"),n.classList.add("selected")):(n.classList.remove("selected"),n.classList.add("Noselected"))});let o=document.querySelectorAll(".selected");o.length>0&&(o.forEach(e=>{const t={id:e.childNodes[9].textContent,nombre:e.childNodes[3].textContent,precio:e.childNodes[5].textContent,cantidad:e.childNodes[7].firstChild.nextSibling.value};orden.productos.push(t)}),mostrarResumen())}))}function mostrarResumen(){const e=document.getElementById("resumen");for(;e.firstChild;)e.removeChild(e.firstChild);const t=document.createElement("h4");t.textContent="Resumen de la Orden",e.appendChild(t);const{hora:n,fecha:o,nombre:a,productos:d}=orden;if(!o||!n)return void crearAlerta("Fecha o Hora no seleccionada","error","#resumen");const r=new Date(o),c=r.getMonth(),s=r.getDate()+2,i=r.getFullYear(),l=new Date(Date.UTC(i,c,s)).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"});d.forEach(t=>{const{cantidad:n,nombre:o,precio:a}=t,d=document.createElement("DIV");d.classList.add("container"),d.classList.add("contenedor-producto"),d.classList.add("mb-4");const r=document.createElement("P");r.classList.add(".nombreProducto"),r.textContent=o;const c=document.createElement("P");c.innerHTML="<span>Precio: </span>$"+a;const s=document.createElement("P");s.innerHTML="<span>Cantidad: </span> "+n;let i=a*n;const l=document.createElement("P");l.classList.add("totalProducto"),suma+=i,l.innerHTML="<span >Total del producto: </span>$"+i,d.appendChild(r),d.appendChild(c),d.appendChild(s),d.appendChild(l),e.appendChild(d)});const u=suma,m=document.createElement("P");m.classList.add("precioFinal"),m.innerHTML="<span>Total de la Orden: </span>$"+u;const p=document.createElement("DIV");p.classList.add("infoContainer"),p.classList.add("mt-3");const h=document.createElement("P");h.textContent=l;const f=document.createElement("P");f.textContent=n+" Horas",p.appendChild(h),p.appendChild(f);const C=document.createElement("BUTTON");C.textContent="Crear Orden",C.classList.add("btn"),C.classList.add("btn-primary"),C.classList.add("text-white"),C.classList.add("boton-ordenar"),C.onclick=hacerOrden,e.appendChild(m),e.appendChild(p),e.appendChild(C)}async function hacerOrden(){const{usuarioId:e,fecha:t,hora:n,nombre:o,productos:a}=orden,d=a.map(e=>e.id,a.cantidad),r=a.map(e=>e.cantidad),c=new FormData;c.append("fecha",t),c.append("hora",n),c.append("usuarioId",e),c.append("productos",d),c.append("cantidad",r);const s=document.querySelector(".boton-ordenar");try{s.setAttribute("disabled",!0);const t=server+"/api/orden",n=await fetch(t,{method:"POST",body:c});(await n.json()).resultado?Swal.fire({icon:"success",title:"Tu orden ha sido creada correctamente",showConfirmButton:!1,timer:1500}).then(()=>{window.location.href=`${server}/perfil/ordenes?id=${e}`}):(Swal.fire({icon:"error",title:"Upss ha habido un problema ",showConfirmButton:!1,timer:1500}),s.setAttribute("disabled",!1))}catch(e){console.log(e)}}function crearAlerta(e,t,n){document.querySelector(".alerta")&&o.remove();const o=document.createElement("DIV");o.textContent=e,o.classList.add("alerta"),o.classList.add(t);document.querySelector(n).appendChild(o),setTimeout(()=>{o.remove()},3e3)}document.addEventListener("DOMContentLoaded",(function(){iniciar()}));